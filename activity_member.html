<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAVITY | 個人活動</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* 基礎佈局 */
        .container { padding: 20px 5%; max-width: 1400px; margin: 0 auto; }
        
        /* 搜尋區塊 */
        .search-container {
            max-width: 900px;
            margin: 20px auto 40px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        .search-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .search-container input {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid var(--main-purple);
            outline: none;
        }
        .btn-search {
            padding: 8px 25px;
            background: var(--dark-purple);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        /* 內容區塊 */
        .group-section { margin-bottom: 50px; position: relative; }
        .group-header { border-left: 6px solid var(--main-purple); padding-left: 15px; margin-bottom: 20px; }
        .group-title { font-size: 1.4rem; color: var(--dark-purple); margin: 0; }

        /* 滑動容器：電腦版與手機版通用對齊 */
        .slider-container {
            position: relative;
            width: 100%;
            padding: 0 20px; 
            box-sizing: border-box;
        }

        .cards-wrapper {
            display: flex; /* 改回 flex，這是處理不露出邊緣最穩定的方法 */
            gap: 25px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 20px 0;
            scrollbar-width: none;
            scroll-snap-type: x mandatory; /* 強制對齊 */
        }
        .cards-wrapper::-webkit-scrollbar { display: none; }

        .activity-card {
            flex: 0 0 calc((100% - 50px) / 3); /* 電腦版預設顯示 3 張 */
            min-width: 280px;
            scroll-snap-align: start;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 照片容器優化 */
        .img-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .img-blur-bg {
            position: absolute;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(15px);
            opacity: 0.4;
            z-index: 1;
        }
        .act-img {
            position: relative;
            z-index: 2;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .act-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; gap: 8px; }
        .act-date { font-size: 0.8rem; color: #888; }
        .act-subtitle { font-weight: bold; color: var(--dark-purple); min-height: 2.8em; }
        .act-cast { font-size: 0.85rem; color: var(--main-purple); height: 2.5em; overflow: hidden; }

        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 48px;
            height: 48px;
            background: white;
            border: 2px solid var(--main-purple);
            color: var(--main-purple);
            border-radius: 50%;
            z-index: 99; /* 提高層級 */
              cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: 0.3s;
        }
        .nav-arrow:hover { background: var(--main-purple); color: white; }
        .nav-arrow.left { left: 5px; }
        .nav-arrow.right { right: 5px; }
        .btn-watch {
    display: block;
    text-align: center;
    padding: 12px;
    background: linear-gradient(135deg, var(--main-purple) 0%, #6a1b9a 100%);
    color: white !important;
    border-radius: 50px; /* 圓角膠囊型 */
    font-weight: bold;
    text-decoration: none;
    transition: 0.3s;
    box-shadow: 0 4px 10px rgba(106, 27, 154, 0.2);
}
.btn-watch:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(106, 27, 154, 0.4);
    filter: brightness(1.1);
}

        /* 手機版 RWD 修正 */
        @media (max-width: 768px) {
            search-container {
        flex-direction: column;
        padding: 20px;
        gap: 12px;
    }
    .search-group {
        width: 100%;
        justify-content: space-between;
    }
    .search-group input {
        flex: 1;
    }
    .btn-search {
        width: 48%; /* 讓兩個按鈕排成一排 */
    }
    .search-buttons {
        display: flex;
        width: 100%;
        gap: 10px;
        justify-content: center;
    }
            nav { flex-direction: column !important; padding: 10px 0; }
            nav ul { 
                flex-direction: row !important; 
                overflow-x: auto; 
                width: 100%; 
                justify-content: flex-start; 
                padding: 10px 20px;
                gap: 15px;
            }
            nav ul li a { white-space: nowrap; font-size: 14px; }

            /* 2. 修正卡片：手機版顯示 100% 寬度，不露出邊緣 */
            .slider-container { padding: 0; }
            .nav-arrow { display: none; }
            .activity-card {
                flex: 0 0 100%;
                scroll-snap-align: start;
            }
            .cards-wrapper { gap: 0; } 
        }
    </style>
</head>
<body>

<nav>
    <div class="logo" id="member-name-title">CRAVITY</div>
    <ul>
        <li><a href="index.html">團體介紹</a></li>
        <li><a href="members.html">成員介紹</a></li>
        <li><a href="discography.html">打歌活動</a></li>
        <li><a href="variety.html">綜藝活動</a></li>
    </ul>
</nav>

<div class="container">
    <div class="search-container">
        <div class="search-group">
            <input type="date" id="startDate">
            <span>至</span>
            <input type="date" id="endDate">
        </div>
        <div class="search-buttons">
            <button class="btn-search" onclick="filterByDate()">搜尋</button>
            <button class="btn-search" style="background:#bbb;" onclick="resetSearch()">清除</button>
        </div>
    </div>
    <div id="activity-list">
        </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const memberId = urlParams.get('member');
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxoOChbgdxhQb-iAwLewfnQgt8kdcBf_lww5VtlHzJxK1_Wuuzz6IxUxvtnAihK-nBD/exec";
    
    let allActivities = [];

    async function loadActivities() {
        if (!memberId) return;
        try {
            const response = await fetch(`${SCRIPT_URL}?type=activities&memberId=${memberId}`);
            const data = await response.json();
            
            allActivities = data.map(act => {
                let cleanDate = "";
                if (act.date) {
                    const d = new Date(act.date);
                    if (!isNaN(d.getTime())) {
                        const y = d.getFullYear();
                        const m = String(d.getMonth() + 1).padStart(2, '0');
                        const day = String(d.getDate()).padStart(2, '0');
                        cleanDate = `${y}-${m}-${day}`;
                    }
                }
                return { ...act, formattedDate: cleanDate, displayDate: cleanDate || "無日期" };
            });

            document.getElementById('member-name-title').innerText = memberId.toUpperCase() + " 活動紀錄";
            displayData(allActivities);
        } catch (err) {
            document.getElementById('activity-list').innerHTML = "<p style='text-align:center;'>資料加載失敗。</p>";
        }
    }

    function displayData(data) {
        if (data.length === 0) {
            document.getElementById('activity-list').innerHTML = "<p style='text-align:center;'>找不到活動紀錄。</p>";
            return;
        }
        const grouped = data.reduce((acc, act) => {
            if (!acc[act.title]) acc[act.title] = [];
            acc[act.title].push(act);
            return acc;
        }, {});
        renderUI(grouped);
    }

    function filterByDate() {
        const start = document.getElementById('startDate').value; 
        const end = document.getElementById('endDate').value;
        if (!start && !end) { displayData(allActivities); return; }
        const filtered = allActivities.filter(act => {
            if (!act.formattedDate) return false;
            if (start && end) return act.formattedDate >= start && act.formattedDate <= end;
            return act.formattedDate === (start || end);
        });
        displayData(filtered);
    }

    function resetSearch() {
        document.getElementById('startDate').value = "";
        document.getElementById('endDate').value = "";
        displayData(allActivities);
    }

    function renderUI(grouped) {
        const container = document.getElementById('activity-list');
        container.innerHTML = "";
        for (const title in grouped) {
            const section = document.createElement('div');
            section.className = 'group-section';
            const cardsHTML = grouped[title].map(act => {
                const safeImgUrl = act.imageUrl ? act.imageUrl.trim() : 'images/none.jpg';
                return `
                    <div class="activity-card">
                        <div class="img-container">
                            <div class="img-blur-bg" style="background-image: url('${safeImgUrl}')"></div>
                            <img src="${safeImgUrl}" class="act-img" onerror="this.src='images/none.jpg';">
                        </div>
                        <div class="act-info">
                            <div class="act-date">${act.displayDate}</div>
                            <div class="act-subtitle">${act.subTitle}</div>
                            <div class="act-cast">參與：${act.cast}</div>
                            <a href="${act.link}" target="_blank" class="btn-watch">觀看連結</a>
                        </div>
                    </div>`;
            }).join('');

            section.innerHTML = `
                <div class="group-header"><h2 class="group-title">${title}</h2></div>
                <div class="slider-container">
                    <button class="nav-arrow left" onclick="scrollSlider(this, -1)">❮</button>
                    <div class="cards-wrapper">${cardsHTML}</div>
                    <button class="nav-arrow right" onclick="scrollSlider(this, 1)">❯</button>
                </div>`;
            container.appendChild(section);
        }
    }

    function scrollSlider(btn, direction) {
    const wrapper = btn.parentElement.querySelector('.cards-wrapper');
    const scrollAmount = wrapper.offsetWidth * 0.8;
    wrapper.scrollBy({ 
        left: direction * scrollAmount, 
        behavior: 'smooth' 
    });
}

    loadActivities();
</script>
</body>
</html>

