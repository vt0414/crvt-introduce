<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAVITY | Discography Activity</title>
    <style>
        /* å»¶ç”¨ä¹‹å‰çš„å¤¢å¹»ç²‰ç´«è®Šæ•¸èˆ‡åŸºç¤æ¨£å¼ */
        :root {
            --main-purple: #ab47bc;
            --dark-purple: #4a148c;
            --glass: rgba(255, 255, 255, 0.5);
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1f9 100%);
            font-family: 'PingFang TC', sans-serif;
            color: var(--dark-purple);
        }

        header { padding: 50px 10%; text-align: center; }
        
        /* æ­Œæ›²åˆ†çµ„å€å¡Š */
        .song-section { margin-bottom: 60px; padding: 0 5%; }
        .song-header {
            display: flex;
            align-items: baseline;
            gap: 15px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--main-purple);
        }
        .song-title { font-size: 2rem; margin: 0; color: var(--dark-purple); }
        .album-tag { color: var(--main-purple); font-weight: bold; }

        /* æ©«å‘æ»‘å‹•å®¹å™¨ */
        .stage-wrapper {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding: 20px 0;
            scroll-snap-type: x mandatory;
        }
        .stage-wrapper::-webkit-scrollbar { height: 6px; }
        .stage-wrapper::-webkit-scrollbar-thumb { background: #e1bee7; border-radius: 10px; }

        /* æ‰“æ­Œèˆå°å¡ç‰‡ */
        .stage-card {
            flex: 0 0 300px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid white;
            scroll-snap-align: start;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
        }

        .stage-img { width: 100%; height: 170px; object-fit: cover; }
        .stage-body { padding: 15px; }
        .stage-date { font-size: 0.8rem; color: var(--main-purple); font-bold; }
        .stage-name { font-size: 1.1rem; margin: 5px 0; font-weight: bold; }

        /* ç›´æ‹å€å¡Šè¨­è¨ˆ */
        .fancam-section {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
        }
        .fancam-label { font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; display: block; }
        
        .fancam-select {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 0.8rem;
            background: white;
            cursor: pointer;
        }

        .view-btn {
            display: block;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: var(--main-purple);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
  <nav>
        <div class="logo">CRAVITY</div>
        <ul>
            <li><a href="index.html">åœ˜é«”ä»‹ç´¹</a></li>
	    <li><a href="members.html">æˆå“¡ä»‹ç´¹</a></li>
            <li><a href="discography.html">æ‰“æ­Œæ´»å‹•</a></li>
            <li><a href="variety.html">ç¶œè—æ´»å‹•</a></li>
        </ul>
    </nav>
    <header>
        <h1>DISCOGRAPHY</h1>
        <p>CRAVITY èˆå°æ´»å‹•ç´€éŒ„</p>
    </header>

    <main id="discography-app">
        </main>

    <script>
        // å‡è¨­å¾ Google Sheet å–å¾—çš„è³‡æ–™çµæ§‹
        // æ¬„ä½ï¼šsong, album, date, cast, imageUrl, stageUrl, fancams (æ–‡å­—æ ¼å¼: "ä¸–ç³:url,å»·è¬¨:url")
        const SHEET_API = 'https://api.sheety.co/ä½ çš„ID/cravity/discography';

        async function loadStages() {
            const app = document.getElementById('discography-app');

            try {
                const response = await fetch(SHEET_API);
                const data = await response.json();
                const stages = data.discography;

                // 1. æŒ‰ã€Œæ­Œæ›² (song)ã€é€²è¡Œåˆ†çµ„
                const grouped = stages.reduce((acc, obj) => {
                    const key = obj.song;
                    if (!acc[key]) acc[key] = [];
                    acc[key].push(obj);
                    return acc;
                }, {});

                // 2. æ¸²æŸ“é é¢
                app.innerHTML = '';
                for (const songName in grouped) {
                    const albumName = grouped[songName][0].album; // å–è©²çµ„ç¬¬ä¸€ç­†çš„å°ˆè¼¯å
                    
                    const section = document.createElement('section');
                    section.className = 'song-section';
                    section.innerHTML = `
                        <div class="song-header">
                            <h2 class="song-title">${songName}</h2>
                            <span class="album-tag">| ${albumName}</span>
                        </div>
                        <div class="stage-wrapper">
                            ${grouped[songName].map(stage => renderStageCard(stage)).join('')}
                        </div>
                    `;
                    app.appendChild(section);
                }
            } catch (err) {
                app.innerHTML = '<p style="text-align:center">è®€å–è³‡æ–™æ™‚å‡ºéŒ¯...</p>';
            }
        }

        function renderStageCard(stage) {
            // è™•ç†ç›´æ‹å­—ä¸²è½‰æ›æˆé¸å–® (æ ¼å¼é æœŸç‚º "æˆå“¡:ç¶²å€,æˆå“¡:ç¶²å€")
            let fancamOptions = '<option value="">-- é¸æ“‡æˆå“¡ç›´æ‹ --</option>';
            if (stage.fancams) {
                const pairs = stage.fancams.split(',');
                pairs.forEach(p => {
                    const [name, url] = p.split(':');
                    fancamOptions += `<option value="${url.trim()}">${name.trim()}</option>`;
                });
            }

            return `
                <div class="stage-card">
                    <img src="${stage.imageUrl}" class="stage-img">
                    <div class="stage-body">
                        <div class="stage-date">${stage.date}</div>
                        <div class="stage-name">${stage.eventTitle || 'Music Stage'}</div>
                        <div class="stage-meta" style="font-size:0.8rem; color:#666;">
                            ğŸ‘¥ åƒèˆ‡äººå“¡ï¼š${stage.cast}
                        </div>
                        
                        <a href="${stage.stageUrl}" target="_blank" class="view-btn" style="background:#4a148c">è§€çœ‹åœ˜é«”èˆå°</a>

                        <div class="fancam-section">
                            <span class="fancam-label">MEMBER FANCAM</span>
                            <select class="fancam-select" onchange="if(this.value) window.open(this.value, '_blank')">
                                ${fancamOptions}
                            </select>
                        </div>
                    </div>
                </div>
            `;
        }

        loadStages();
    </script>
</body>
</html>